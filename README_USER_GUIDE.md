# Coqui TTS 系统用户指南

<div align="right">
  <a href="README_USER_GUIDE.md">中文</a> | <a href="README_USER_GUIDE_en.md">English</a>
</div>

# 文本朗读助手：使用指南

## 目录
- [项目介绍](#项目介绍)
- [项目背景](#项目背景)
- [系统组件](#系统组件)
- [所需软件和库](#所需软件和库)
- [安装指南](#安装指南)
- [使用指南](#使用指南)
- [如何选择适合您的方案](#如何选择适合您的方案)
- [自定义选项](#自定义选项)
- [常见问题与解决方法](#常见问题与解决方法)
- [技术支持](#技术支持)

## 项目介绍

文本朗读助手是一个便捷的工具，可以将复制到剪贴板的文本自动转换为语音并朗读出来。无论您是在浏览网页、阅读文档，还是处理电子邮件，只需复制文本并按下特定的快捷键组合，系统就会自动为您朗读内容。该工具支持中文和英文，可自动识别文本语言并使用合适的语音模型。

这个工具特别适合：
- 想要通过听觉学习的用户
- 需要减轻视觉疲劳的用户
- 多任务处理时需要信息输入的用户
- 学习语言发音的用户

## 项目背景

这个项目最初是为了解决长时间阅读文本导致的视觉疲劳问题而开发的。在开发过程中，我们发现许多用户在使用VPN时遇到了本地连接问题，因此我们扩展了项目，提供了多种解决方案来适应不同的网络环境。

从最初的微服务架构，到VPN兼容版本，再到完全独立的应用程序，我们的目标始终是提供一个稳定、便捷的文本朗读体验，无论用户身处何种网络环境。

## 系统组件

本项目包含多个组件，为了适应不同的使用场景和环境（特别是VPN环境），我们提供了多种解决方案：

### 1. 微服务版本

微服务版本将TTS（文本转语音）功能拆分为客户端和服务器两部分：

- **TTS服务器** (`tts_server.py`)：负责加载语音模型并处理文本转语音请求
- **TTS客户端** (`tts_client.py`)：发送文本到服务器并播放返回的音频
- **热键监听器** (`hotkey_tts.py`)：监听特定热键组合，读取剪贴板内容并通过客户端发送请求

这种架构的优点是服务器只需要启动一次，而客户端可以快速响应，减少每次朗读时的等待时间。

### 2. VPN兼容版本

针对在VPN环境下使用时可能出现的连接问题，我们开发了专门的VPN兼容解决方案：

- **VPN兼容客户端** (`vpn_compatible_tts.py`)：能够自动尝试多种连接方式的增强版客户端
- **连接诊断工具** (`debug_vpn_connection.py`)：用于诊断VPN环境下的网络连接问题
- **直接TCP连接工具** (`direct_tts_client.py`)：尝试绕过HTTP层直接连接服务器

### 3. 独立版本

为了完全避免网络连接问题，我们还提供了一个完全独立的解决方案：

- **独立TTS应用** (`standalone_tts.py`)：将所有功能集成到一个独立的应用程序中，不依赖于网络连接

### 4. 启动脚本

为了方便使用，我们提供了多个Shell脚本来启动不同的组件：

- `run_server.sh`：启动TTS服务器
- `run_client.sh`：运行TTS客户端示例
- `run_hotkey_mac.sh`：启动macOS专用热键监听器
- `run_standalone.sh`：启动独立TTS应用
- `run_vpn_tts.sh`：启动VPN兼容版热键监听器

## 所需软件和库

本项目依赖以下软件和Python库：

### 基础软件
- Python 3.7+：项目的编程语言
- pip：Python包管理工具
- 终端应用：运行脚本的环境

### Python库
- **TTS**：Coqui TTS库，提供文本转语音功能
- **Flask**：用于创建微服务API
- **requests**：用于发送HTTP请求
- **pynput**：用于监听全局热键（特别适合macOS）
- **keyboard**：提供热键监听功能（主要用于Windows/Linux）
- **pyperclip**：用于读取剪贴板内容
- **torch**：PyTorch机器学习库，TTS模型的基础

## 安装指南

### 步骤1: 安装Python

如果您尚未安装Python，请从[Python官网](https://www.python.org/downloads/)下载并安装Python 3.7或更高版本。

### 步骤2: 获取项目文件

您可以通过以下方式获取项目文件：

1. **GitHub克隆**（如果项目在GitHub上）:
   ```
   git clone https://github.com/用户名/项目名.git
   cd 项目名
   ```

2. **下载ZIP文件**:
   - 访问项目的GitHub页面
   - 点击"Code"按钮，然后选择"Download ZIP"
   - 解压下载的ZIP文件到您选择的文件夹

3. **从其他渠道下载**:
   - 将所有项目文件下载到您的计算机上
   - 确保所有文件都保存在同一个文件夹中

### 步骤3: 安装依赖库

打开终端或命令提示符，导航到项目文件夹，然后运行以下命令：

```
pip install TTS flask requests pynput keyboard pyperclip
```

对于Windows系统，还需要安装：
```
pip install playsound
```

### 步骤4: 设置权限（macOS和Linux）

在macOS或Linux系统上，您需要为Shell脚本添加执行权限：

```
chmod +x run_server.sh run_client.sh run_hotkey_mac.sh run_standalone.sh run_vpn_tts.sh
```

如果您使用macOS，还需要在"系统偏好设置 > 安全性与隐私 > 隐私 > 辅助功能"中授予终端应用访问权限。

## 如何选择适合您的方案

根据您的使用环境和需求，选择合适的方案：

1. **标准微服务方案**：
   - 适合：正常网络环境，无VPN
   - 优点：服务器只需启动一次，后续响应快速
   - 使用方式：启动服务器 + 热键监听器

2. **VPN兼容版**：
   - 适合：使用VPN但连接问题不严重
   - 优点：自动尝试多种连接方式
   - 使用方式：启动服务器 + VPN兼容热键监听器

3. **独立解决方案**：
   - 适合：VPN环境下连接问题严重或完全无法连接
   - 优点：不依赖网络，最稳定的解决方案
   - 使用方式：只需启动独立应用

选择指南：
- 首先尝试标准微服务方案
- 如果使用VPN时遇到连接问题，尝试VPN兼容版
- 如果仍然有问题，使用独立解决方案
- 如需诊断连接问题，运行诊断工具

## 使用指南

我们建议根据您的使用环境选择不同的解决方案：

### 方案1: 标准微服务方案（适合普通网络环境）

1. 首先启动TTS服务器：
   ```
   ./run_server.sh
   ```

2. 在另一个终端窗口中启动热键监听器：
   ```
   ./run_hotkey_mac.sh
   ```

3. 在任何应用中复制文本，然后按下 `ctrl+option+cmd+p` 热键组合。

### 方案2: 独立解决方案（适合VPN环境或不稳定网络）

1. 只需启动独立TTS应用：
   ```
   ./run_standalone.sh
   ```

2. 在任何应用中复制文本，然后按下 `ctrl+option+cmd+p` 热键组合。

### 方案3: VPN兼容版（适合轻度VPN干扰情况）

1. 首先启动TTS服务器：
   ```
   ./run_server.sh
   ```

2. 启动VPN兼容版热键监听器：
   ```
   ./run_vpn_tts.sh
   ```

3. 在任何应用中复制文本，然后按下 `ctrl+option+cmd+p` 热键组合。

### 诊断网络问题

如果您在VPN环境下遇到连接问题，可以运行诊断工具：
```
python debug_vpn_connection.py
```

## 自定义选项

您可以通过命令行参数自定义热键和其他设置：

### 更改热键组合

```
python standalone_tts.py --hotkey "ctrl+shift+t"
```

### 指定特定的TTS模型

```
python standalone_tts.py --model "tts_models/en/ljspeech/tacotron2-DDC"
```

### 指定语言

```
python standalone_tts.py --language "zh-cn"
```

## 常见问题与解决方法

### 1. 热键不起作用

- **问题**: 按下热键组合后没有反应
- **解决方法**: 
  - 确保您已经授予终端应用辅助功能权限（macOS）
  - 尝试不同的热键组合，如 `ctrl+shift+t`
  - 重新启动热键监听器或独立应用

### 2. VPN环境下连接失败

- **问题**: 使用VPN时无法连接到TTS服务器
- **解决方法**:
  - 使用独立版本 (`run_standalone.sh`)
  - 或在VPN设置中启用分隧道(split tunneling)，允许本地连接绕过VPN

### 3. 中文朗读不正确

- **问题**: 中文文本朗读不正确或使用英文发音
- **解决方法**:
  - 确保已下载多语言模型 (`tts_models/multilingual/multi-dataset/xtts_v2`)
  - 手动指定语言: `--language zh-cn`

### 4. 程序启动很慢

- **问题**: 独立版本或服务器启动需要很长时间
- **解决方法**:
  - 这是正常的，因为需要加载TTS模型
  - 第一次启动后，模型会被缓存，后续启动会更快
  - 微服务架构下，服务器只需启动一次，客户端会快速响应

### 5. 内存占用高

- **问题**: 程序占用大量内存
- **解决方法**:
  - TTS模型需要一定的内存，这是正常的
  - 如果内存有限，可以选择较小的模型: `--model tts_models/en/ljspeech/tacotron2-DDC`

## 技术支持

如果您遇到本文档未涵盖的问题，或需要进一步的技术支持，请查看代码中的详细注释或参考项目中的`vpn_issue_resolution.md`文档，其中包含了更详细的技术信息和故障排除指南。 